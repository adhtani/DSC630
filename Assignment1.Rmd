---
title: "Assignment 1.2"
author: "Taniya Adhikari"
date: "03/22/2021"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}

# required packages
library(ggplot2)
library(ggpubr)
library(knitr)
library(tidyverse)
library(rjson)
library(blsAPI)
library(pastecs)
library(corrplot)
library(qwraps2)

```

### 1. Import, Plot, Summarize, and Save Data.  
  
#### Importing the data  
```{r}
## Pull the data via the API
dta <- list('seriesid'=c('LNS14000000', 'CUSR0000SAF1', 
               'CUSR0000SETB01', 'CUSR0000SAM2', 'CUSR0000SA0'),'startyear'=2010,'endyear'=2020)

# fetching data from bls API
response <- blsAPI(dta, 2)
json <- fromJSON(response)

## Process results
apiDF <- function(data){
  df <- data.frame(year=character(),
                   period=character(),
                   periodName=character(),
                   value=character(),
                   stringsAsFactors=FALSE)
  
  i <- 0
  for(d in data){
    i <- i + 1
    df[i,] <- unlist(d)
  }
  return(df)
}

unemployment.df <- apiDF(json$Results$series[[1]]$data)
food.df <- apiDF(json$Results$series[[2]]$data)
gas.df <- apiDF(json$Results$series[[3]]$data)
medical_services.df <- apiDF(json$Results$series[[4]]$data)
all_items.df <- apiDF(json$Results$series[[5]]$data)

## Change value type from character to numeric
unemployment.df[,4] <- as.numeric(unemployment.df[,4])
food.df[,4] <- as.numeric(food.df[,4])
gas.df[,4] <- as.numeric(gas.df[,4])
medical_services.df[,4] <- as.numeric(medical_services.df[,4])
all_items.df[,4] <- as.numeric(all_items.df[,4])

## Rename value prior to merging
names(unemployment.df)[4] <- 'unemployement_rate'
names(food.df)[4] <- 'food'
names(gas.df)[4] <- 'gas'
names(medical_services.df)[4] <- 'medical_services'
names(all_items.df)[4] <- 'all_items'

## Merge data frames
df1 <- merge(unemployment.df, food.df)
df2 <- merge(df1, gas.df)
df3 <- merge(df2, medical_services.df)
df <- merge(df3, all_items.df)

df$date <- as.POSIXct(strptime(paste0('1',df$periodName,df$year), '%d%B%Y'))


```

#### Summarizing the data  
```{r, echo=FALSE}

## Summary for unemployment 
var = df %>% select(food, gas)
five_num = summary(var)
desc_stat <- stat.desc(var,basic=FALSE, desc=TRUE, norm=TRUE, p=0.95)
knitr::kable(five_num, caption = "Summary Statistics Table")
knitr::kable(desc_stat, digits =2,format = "pandoc", caption = "Descriptive Statistics Table")

```

#### Plotting the data  
```{r, echo=FALSE}

# histogram
ggplot(df, aes(x=food)) + 
  geom_histogram(aes(y=..density..), bins=40,color="black", fill="lightblue") +
  ggtitle("Food in U.S. city average, all urban consumers, with Normal Curve") + 
  xlab("Food") + ylab("Consumer Expenditure") +
  xlim(200,275) + 
  stat_function(fun = dnorm, args = list(mean = mean(df$food), sd = sd(df$food)), color = "darkblue")

# histogram
ggplot(df, aes(x=gas)) + 
  geom_histogram(aes(y=..density..), bins=40,color="black", fill="lightblue") +
  ggtitle("Gas in U.S. city average, all urban consumers, with Normal Curve") + 
  xlab("Gas") + ylab("Consumer Expenditure") +
  xlim(100,400) + 
  stat_function(fun = dnorm, args = list(mean = mean(df$gas), sd = sd(df$gas)), color = "darkblue")

# Line Chart
ggplot(df, aes(x=date, y=unemployement_rate)) + 
  geom_line() +
  ggtitle("Unemployment rate in U.S. city average") + 
  xlab("Time") + ylab("Unemployment")

```

#### Saving the data  
```{r, echo=FALSE}

## copying data into csv file
write.csv(df, file="bls_data.csv", row.names = FALSE)

```

### 2. Explore Some Bivariate Relations.  
  
#### Bivariate Relations  
Scatter Plot  

```{r, echo=FALSE}

ggplot(df, aes(x=food, y=unemployement_rate)) +
  geom_point(color='#56B4E9') +
  ggtitle("Food Consumption vs. Unemployment rate") + 
  xlab("Food") + ylab("Unemployment")

ggplot(df, aes(x=all_items, y=gas)) +
    geom_point(color='red') +
    ggtitle("All Items Consumption vs. Gas Consumption") + 
    xlab("All Items") + ylab("Gas") 
```

Correlation Matrix and Correlation Plot

```{r, echo=FALSE}

var2 = df %>% select(unemployement_rate, food, gas, medical_services, all_items)
knitr::kable(cor(var2), digits =2,format = "pandoc", caption = "Correlation Coefficient of variables")

corrplot(cor(var2), type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45)
```

### 3. Organize Data Report.  
  
#### Summary Reports  

```{r, echo=FALSE}

kable(summary(df), caption = "Summary of the Variables")
str(df)
desc_stat <- stat.desc(var2,basic=FALSE, desc=TRUE, norm=TRUE, p=0.95)
knitr::kable(desc_stat, digits =2,format = "pandoc", caption = "Descriptive Statistics Table")
```
  
In this dataset we have 120 observations and following variables:  
  
1. *year*: This is a categorical variable. Does not have significance because it is redundant variable. I already have date variable.  
2. *period*: This is a categorical variable.Does not have significance because it is just month variable.  
3. *periodName*: This is a categorical variable. Does not have significance because it is just month variable.  
4. *unemployement_rate*: This is a continuous numerical variable.
5. *food*: This is a continuous numerical variable.
6. *gas*: This is a continuous numerical variable.
7. *medical_services*: This is a continuous numerical variable.
8.*all_items*: This is a continuous numerical variable.
9.*date*: This is date in datetime format.  
  

Data is monthly average over the period of 2010-2020.  
  
#### Key Insights  
1. The median monthly unemployment rate over the period of 10 years (2010-2020) is 5.65%.  
2. The mean and median of all_items consumption is same indicating that data maybe normally distributed. However, p-value of Shapiro-Wilk Test is less than 0.05 indicating data is not normally distributed.
3. None of the variables are normally distributed because all the p-values are below 0.05  
4. The range of average food consumption in all American cities falls between 218.5 to 260.4 over the period od 2010-2020.  

